<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="The Freedom Compass - Your personal financial command center. Track income, expenses, investments, and build your path to financial freedom."
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>The Freedom Compass - Financial Dashboard</title>
    
    <!-- ðŸ“Š GOOGLE ANALYTICS 4 - Mission-Critical Tracking -->
    <!-- SETUP INSTRUCTIONS:
         1. Go to https://analytics.google.com/
         2. Create new GA4 property for "The Freedom Compass"
         3. Get your Measurement ID (format: G-XXXXXXXXXX)
         4. Replace "G-XXXXXXXXXX" below with your actual ID
    -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R2943ZZYSK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      // ðŸŽ¯ Initialize GA4 with enhanced tracking
      gtag('config', 'G-R2943ZZYSK', {
        'send_page_view': true,
        'anonymize_ip': true, // Privacy compliance
        'cookie_flags': 'SameSite=None;Secure'
      });
      
      // ðŸ”§ Make gtag globally accessible for event tracking
      window.gtag = gtag;
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script>
      // ðŸ”§ PREMIUM MOBILE KEYBOARD FIX - Viewport restoration without scroll-to-top
      (function() {
        // Set CSS variable for viewport height (fixes iOS Safari keyboard issue)
        function setVH() {
          let vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        // Set on load
        setVH();
        
        // Update on resize
        window.addEventListener('resize', setVH);
        window.addEventListener('orientationchange', setVH);
        
        // ðŸŽ¯ NEW: ENHANCED Visual Viewport API for ultra-smooth keyboard handling
        // This fixes the "bottom gap" issue when keyboard closes
        if (window.visualViewport) {
          let previousHeight = window.visualViewport.height;
          
          window.visualViewport.addEventListener('resize', () => {
            const currentHeight = window.visualViewport.height;
            const heightDifference = currentHeight - previousHeight;
            
            // Keyboard is CLOSING (viewport getting bigger)
            if (heightDifference > 100) {
              // ENHANCED: Shorter delay for snappier response
              setTimeout(() => {
                // Get current scroll position
                const currentScroll = window.scrollY || document.documentElement.scrollTop;
                
                // Only adjust if we're not at the very top
                // This prevents unwanted scroll-to-top
                if (currentScroll > 0) {
                  // ENHANCED: Double reflow trigger for better gap fix
                  // First adjustment - triggers initial reflow
                  window.scrollTo({
                    top: currentScroll - 1,
                    behavior: 'auto'
                  });
                  
                  // Force immediate reflow
                  document.body.offsetHeight;
                  
                  // Second adjustment - ensures complete layout
                  window.scrollTo({
                    top: currentScroll,
                    behavior: 'auto'
                  });
                  
                  // Force another reflow for stubborn browsers
                  void document.body.offsetWidth;
                  
                  // Final viewport recalculation
                  requestAnimationFrame(() => {
                    setVH();
                  });
                } else {
                  // Even at top, update viewport height
                  setVH();
                }
              }, 80); // ENHANCED: 80ms instead of 100ms for snappier feel
            }
            
            previousHeight = currentHeight;
          });
        }
        
        // ðŸ›¡ï¸ Fallback for older browsers
        // Only fixes viewport height, no scroll manipulation
        else {
          let resizeTimer;
          window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
              setVH();
            }, 150);
          });
        }
      })();
      
      // ðŸ“± Register Service Worker for PWA functionality
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('ðŸ“± SW registered: ', registration);
            })
            .catch((registrationError) => {
              console.log('ðŸ“± SW registration failed: ', registrationError);
            });
        });
      }
    </script>
  </body>
</html>